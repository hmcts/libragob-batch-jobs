\copy (SELECT to_char(date_trunc('day',updated_date),'dd/mm/yyyy') as "Date",round(avg(TOTAL_SEC)*1000) as "AVG(Total Roundtrip in Millisecs)",round(sum(TOTAL_SEC/3600)::numeric,1) as "TotalWorkload in Hours",count(*) as "RecordCount" FROM (SELECT a.updated_date,a.message_uuid as uuid,EXTRACT(EPOCH from (b.updated_date-a.updated_date)) as TOTAL_SEC FROM (select updated_date,message_status_id,message_uuid from themis_dac.message_audit where message_status_id = 1 and action_type='getUpdateRequest') a,(select updated_date,message_status_id,message_uuid from themis_dac.message_audit where message_status_id = 10 and action_type='getUpdateRequestResponse') b WHERE a.message_uuid = b.message_uuid) x GROUP BY to_char(date_trunc('day',updated_date),'dd/mm/yyyy') order by 1 desc) To '/tmp/ams-reporting/12eAZUREDB_AMD_dacaudit_step10-1_avgDailyRT.csv' With CSV DELIMITER ','
